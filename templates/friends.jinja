{% extends 'base.jinja' %}

{% block content %}

<h2>Friends List</h2>
<table id="friends-list" style="border: 1px solid black">
  <tr>
    <th style="background-color: yellow;">Friends</th>
  </tr>
  {% for friend in friends_list %}
    <tr>
      <td style="border: 1px solid black">{{ friend }}</td>
    </tr>
  {% endfor %}
</table>

<h2>Add a New Friend</h2>
<form id="friend_form">
  <label for="enter_value">Friend's Username:</label><br>
  <input type="text" id="enter_value" name="enter_value">
  <input type="submit" value="Submit">
</form>

<h2>Friend requests sent</h2>
<ul id="requests-sent-list"></ul>

<h2>Friend requests received</h2>
<ul id="requests-received-list"></ul>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const friendForm = document.getElementById('friend_form');
        friendForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const friendUsername = document.getElementById('enter_value').value;
            const senderUsername = '{{ username }}';

            const requestsSent = document.getElementById('requests-sent-list')
            requestsSent.innerHTML = '';
            const friend_in_list = document.createElement('li')
            friend_in_list.textContent = friendUsername
            requestsSent.appendChild(friend_in_list)

            const server_data = {
                "sender": senderUsername,
                "receiver": friendUsername
            };
            $.ajax({
                url: '/home/send_fr',
                data: JSON.stringify(server_data),
                contentType: 'application/json',
                dataType: 'json',
                type: 'POST',
                success: function(response) {
                    console.log(response);
                },
                error: function(error) {
                    console.log(error);
                }
            });

        });
    });
</script>


{% endblock %}
